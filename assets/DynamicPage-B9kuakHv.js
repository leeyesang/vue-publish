import{r as c,u as D,a as I,c as x,o as E,w as P,b as r,d as v,t as F,e as u,f as d,D as V,F as q,g as j,h,i as C,R as O,s as m,j as i}from"./index-Cq3hQzo1.js";import R from"./DynamicImageUpload-BJuEnNFa.js";const S={class:"p-4 max-w-3xl mx-auto"},U={class:"text-xl font-bold mb-4"},z={key:0},A={class:"flex gap-2 mt-4"},L={key:1},p="page_01",Q={__name:"DynamicPage",setup(N){const y=D(),n=c(y.params.id||p),o=c([]),s=c(null),l=I({}),_=e=>e.type==="image"?null:e.type==="text"?{dataField:e.name,label:{text:e.label},editorType:"dxTextBox"}:e.type==="number"?{dataField:e.name,label:{text:e.label},editorType:"dxNumberBox"}:e.type==="textarea"?{dataField:e.name,label:{text:e.label},editorType:"dxTextArea"}:e.type==="select"?{dataField:e.name,label:{text:e.label},editorType:"dxSelectBox",editorOptions:{items:e.options||[],searchEnabled:!0}}:e.type==="checkbox"?{dataField:e.name,label:{text:e.label},editorType:"dxTagBox",editorOptions:{items:e.options||[],showSelectionControls:!0}}:{dataField:e.name,label:{text:e.label},editorType:"dxTextBox"},f=x(()=>s.value?s.value.fields.map(_).filter(Boolean):[]),g=x(()=>s.value?.fields.filter(e=>e.type==="image")||[]),T=e=>{Object.keys(l).forEach(a=>delete l[a]),e.fields.forEach(a=>{a.type==="checkbox"?l[a.name]=[]:a.type==="image"?l[a.name]=[]:l[a.name]=""})},b=async()=>{o.value.length||(o.value=await m.getPages()||[]);const e=o.value.find(t=>t.id===n.value)||null;if(s.value=e,!e)return;T(e);const a=await m.loadForm(n.value);a&&typeof a=="object"&&Object.keys(a).forEach(t=>l[t]=a[t])};E(b),P(()=>y.params.id,async e=>{n.value=e||p,await b()});const w=async()=>{await m.saveForm(n.value,{...l}),await m.putPending({pageId:n.value,data:{...l},ts:Date.now()}),alert("저장됨(오프라인)")},B=x(()=>{if(!o.value.length)return{name:"dynamic",params:{id:p}};const e=o.value.findIndex(t=>t.id===n.value);return{name:"dynamic",params:{id:o.value[e+1]?.id??o.value[0].id}}});return(e,a)=>(i(),r("div",S,[v("h2",U,F(s.value?.title||"동적 페이지"),1),s.value?(i(),r("div",z,[u(d(V),{class:"mb-4","form-data":l,items:f.value,"label-location":"top","col-count":1},null,8,["form-data","items"]),(i(!0),r(q,null,j(g.value,t=>(i(),r("div",{key:t.name,class:"mb-4"},[u(R,{modelValue:l[t.name],"onUpdate:modelValue":k=>l[t.name]=k,label:t.label,multiple:t.multiple??!0,"max-count":t.maxCount??10,"max-size-m-b":t.maxSizeMB??10,"max-px":t.maxPx??1600,quality:t.quality??.8,"thumb-px":t.thumbPx??256,"thumb-quality":t.thumbQuality??.7},null,8,["modelValue","onUpdate:modelValue","label","multiple","max-count","max-size-m-b","max-px","quality","thumb-px","thumb-quality"])]))),128)),v("div",A,[u(d(h),{type:"default","styling-mode":"contained",text:"저장",onClick:w}),u(d(O),{to:B.value},{default:C(()=>[u(d(h),{type:"success","styling-mode":"contained",text:"다음 ▶"})]),_:1},8,["to"])])])):(i(),r("div",L,"페이지 로딩 중…"))]))}};export{Q as default};
