import{E as X,_ as T,k as s,l as w,m as se,n as P,p as k,q as le,v as c,x as re,y as de,z as E,A as R,B as h,C as ue,G as y,H as v,I as M,J as B,K as F,L as pe,M as Y,N as ce,O as V,P as N,Q as Z,S as H,T as $,U as G,V as he,W as _e,X as ge,r as L,w as ve,b as x,d as m,e as me,t as A,Y as z,F as fe,g as be,Z as Se,f as Fe,j as C,$ as xe}from"./index-Cq3hQzo1.js";class J extends X{_getDefaultOptions(){return T({},super._getDefaultOptions(),{min:0,max:100,value:0})}_initMarkup(){this.$element().addClass("dx-trackbar"),this._renderWrapper(),this._renderContainer(),this._renderRange(),this._renderValue(),this._setRangeStyles(),super._initMarkup()}_render(){super._render(),this._setRangeStyles(this._rangeStylesConfig())}_renderWrapper(){this._$wrapper=s("<div>").addClass("dx-trackbar-wrapper").appendTo(this.$element())}_renderContainer(){this._$bar=s("<div>").addClass("dx-trackbar-container").appendTo(this._$wrapper)}_renderRange(){this._$range=s("<div>").addClass("dx-trackbar-range").appendTo(this._$bar)}_renderValue(){const{value:e,min:t,max:a}=this.option();if(t>a)return;if(e<t){this.option("value",t),this._currentRatio=0;return}if(e>a){this.option("value",a),this._currentRatio=1;return}const o=t===a?0:(e-t)/(a-t);this._needPreventAnimation||this._setRangeStyles({width:100*o+"%"}),this.setAria({valuemin:this.option("min"),valuemax:a,valuenow:e}),this._currentRatio=o}_rangeStylesConfig(){return{width:100*this._currentRatio+"%"}}_setRangeStyles(e){if(w.stop(this._$range),!e){this._$range.css({width:0});return}this._needPreventAnimation||!se()||w.animate(this._$range,{type:"custom",duration:100,to:e})}_optionChanged(e){switch(e.name){case"value":this._renderValue(),super._optionChanged(e);break;case"max":case"min":this._renderValue();break;default:super._optionChanged(e)}}_dispose(){w.stop(this._$range),super._dispose()}}P("dxTrackBar",J);const W="dx-progressbar-animating-segment";class Q extends J{_getDefaultOptions(){return T({},super._getDefaultOptions(),{value:0,statusFormat:e=>`Progress: ${Math.round(100*e)}%`,showStatus:!0,onComplete:null,activeStateEnabled:!1,statusPosition:"bottom left",_animatingSegmentCount:0})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:e=>e.platform==="android",options:{_animatingSegmentCount:2}}])}_toggleReadOnlyState(){this.setAria("readonly",void 0)}_initMarkup(){this._renderStatus(),this._createCompleteAction(),super._initMarkup(),this.$element().addClass("dx-progressbar"),this._$wrapper.addClass("dx-progressbar-wrapper"),this._$bar.addClass("dx-progressbar-container"),this.setAria("role","progressbar"),s("<div>").addClass("dx-progressbar-range-container").appendTo(this._$wrapper).append(this._$bar),this._$range.addClass("dx-progressbar-range");const{showStatus:e}=this.option();this._toggleStatus(e)}_useTemplates(){return!1}_createCompleteAction(){this._completeAction=this._createActionByOption("onComplete")}_renderStatus(){this._$status=s("<div>").addClass("dx-progressbar-status")}_renderIndeterminateState(){this._$segmentContainer=s("<div>").addClass("dx-progressbar-animating-container");const{_animatingSegmentCount:e}=this.option();for(let t=0;t<e;t+=1)s("<div>").addClass(W).addClass(`${W}-${t+1}`).appendTo(this._$segmentContainer);this._$segmentContainer.appendTo(this._$wrapper)}_toggleStatus(e){const{statusPosition:t}=this.option(),a=t.split(" ");e?a[0]==="top"||a[0]==="left"?this._$status.prependTo(this._$wrapper):this._$status.appendTo(this._$wrapper):this._$status.detach(),this._togglePositionClass()}_togglePositionClass(){const{statusPosition:e}=this.option(),t=e.split(" ");this._$wrapper.removeClass("dx-position-top-left dx-position-top-right dx-position-bottom-left dx-position-bottom-right dx-position-left dx-position-right");let a=`dx-position-${t[0]}`;t[1]&&(a+=`-${t[1]}`),this._$wrapper.addClass(a)}_toggleIndeterminateState(e){if(e)this._renderIndeterminateState(),this._$bar.toggle(!1);else{var t;this._$bar.toggle(!0),(t=this._$segmentContainer)===null||t===void 0||t.remove(),delete this._$segmentContainer}}_renderValue(){const{value:e,max:t}=this.option();if(!e&&e!==0){this._toggleIndeterminateState(!0);return}this._$segmentContainer&&this._toggleIndeterminateState(!1),e===t&&this._completeAction(),super._renderValue(),this._setStatus()}_setStatus(){const{statusFormat:e}=this.option();let t=e;k(t)?t=t.bind(this):t=function(o){return o};const a=t(this._currentRatio,this.option("value"));this._$status.text(a)}_dispose(){this._$status.remove(),super._dispose()}_optionChanged(e){const{name:t,value:a}=e;switch(t){case"statusFormat":this._setStatus();break;case"showStatus":this._toggleStatus(a);break;case"statusPosition":{const{showStatus:o}=this.option();this._toggleStatus(o);break}case"onComplete":this._createCompleteAction();break;case"_animatingSegmentCount":break;default:super._optionChanged(e)}}}P("dxProgressBar",Q);const U=ce();let Ce=()=>s("<input>").attr("type","file");const O=()=>!!U.FormData;class ye{constructor(e,t){this.file=e,this.chunkSize=t,this.index=0}read(){if(!this.file)return null;const e=this.createBlobResult(this.file,this.index,this.chunkSize);return e.isCompleted&&(this.file=null),this.index+=1,e}createBlobResult(e,t,a){const o=t*a;return{blob:this.sliceFile(e,o,a),index:t,isCompleted:o+a>=e.size}}sliceFile(e,t,a){return e.slice?e.slice(t,t+a):"webkitSlice"in e&&typeof e.webkitSlice=="function"?e.webkitSlice(t,t+a):null}}class ee{constructor(e){this.fileUploader=e}upload(e){if(e.isInitialized&&e.isAborted){var t;(t=this.fileUploader)===null||t===void 0||t._resetFileState(e)}e.isValid()&&!e.uploadStarted&&(this._prepareFileBeforeUpload(e),this._uploadCore(e))}abortUpload(e){var t;if(!(e._isError||e._isLoaded||e.isAborted||!e.uploadStarted)&&(e.isAborted=!0,(t=e.request)===null||t===void 0||t.abort(),this._isCustomCallback("abortUpload"))){const{abortUpload:o}=this.fileUploader.option(),i=this._createUploadArgument(e);let n=null;try{const l=o?.(e.value,i);n=H(l)}catch(l){n=$().reject(l).promise()}if(n&&"done"in n){var a;(a=n)===null||a===void 0||a.done((()=>e.onAbort.fire())).fail((l=>this._handleFileError(e,l)))}}}_beforeSend(e,t){var a,o;const i=this._createUploadArgument(t);(a=(o=this.fileUploader)._beforeSendAction)===null||a===void 0||a.call(o,{request:e,file:t.value,uploadInfo:i}),t.request=e}_createUploadArgument(e){return{bytesUploaded:0,chunkCount:0,customData:{},chunkBlob:new Blob,chunkIndex:0}}_uploadCore(e){}_isCustomCallback(e){var t;const a=(t=this.fileUploader)===null||t===void 0?void 0:t.option(e);return a&&k(a)}_handleProgress(e,t){e._isError||(e._isProgressStarted=!0,this._handleProgressCore(e,t))}_handleProgressCore(e,t){}_handleFileError(e,t){e._isError=!0,e.onError.fire(t)}_prepareFileBeforeUpload(e){if(e.$file){var t;(t=e.progressBar)===null||t===void 0||t.dispose(),this.fileUploader._createFileProgressBar(e)}e.isInitialized||(e.onLoadStart.add(this._onUploadStarted.bind(this,e)),e.onLoad.add(this._onLoadedHandler.bind(this,e)),e.onError.add(this._onErrorHandler.bind(this,e)),e.onAbort.add(this._onAbortHandler.bind(this,e)),e.onProgress.add(this._onProgressHandler.bind(this,e)),e.isInitialized=!0)}_shouldHandleError(e,t){return(this._isStatusError(t.status)||!e._isProgressStarted)&&!e.isAborted}_isStatusError(e){return e>=400&&e<500||e>=500&&e<600}_onUploadStarted(e,t){var a,o;e.uploadStarted=!0,(a=this.fileUploader)===null||a===void 0||(o=a._uploadStartedAction)===null||o===void 0||o.call(a,{file:e.value,event:t,request:e.request})}_onAbortHandler(e,t){var a,o,i;const n={file:e.value,event:t,request:e.request,message:(a=this.fileUploader)===null||a===void 0?void 0:a._getUploadAbortedStatusMessage()};(o=(i=this.fileUploader)._uploadAbortedAction)===null||o===void 0||o.call(i,n),this.fileUploader._setStatusMessage(e,n.message),this.fileUploader._handleAllFilesUploaded()}_onErrorHandler(e,t){var a,o,i,n;const{uploadFailedMessage:l}=this.fileUploader.option(),r={file:e.value,event:void 0,request:e.request,error:t,message:l};(a=(o=this.fileUploader)._uploadErrorAction)===null||a===void 0||a.call(o,r),(i=(n=this.fileUploader)._setStatusMessage)===null||i===void 0||i.call(n,e,r.message),this.fileUploader._handleAllFilesUploaded()}_onLoadedHandler(e,t){var a,o;const{uploadedMessage:i}=this.fileUploader.option(),n={file:e.value,event:t,request:e.request,message:i};e._isLoaded=!0,(a=(o=this.fileUploader)._uploadedAction)===null||a===void 0||a.call(o,n),this.fileUploader._setStatusMessage(e,n.message),this.fileUploader._handleAllFilesUploaded()}_onProgressHandler(e,t){if(e){const a=this.fileUploader._getTotalFilesSize(),o=this.fileUploader._getTotalLoadedFilesSize(),i=t.loaded??0,n=Math.min(i,e.value.size),l=n-e.loadedSize;e.loadedSize=n,this.fileUploader._updateTotalProgress(a,o+l),this.fileUploader._updateProgressBar(e,this._getLoadedData(n,t.total,l,t))}}_getLoadedData(e,t,a,o){return{loaded:e,total:t,currentSegmentSize:a}}_extendFormData(e){const{uploadCustomData:t}=this.fileUploader.option();for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&v(t[a])&&e.append(a,t[a])}}class te extends ee{constructor(e){super(e);const{chunkSize:t}=this.fileUploader.option();this.chunkSize=t??0}_uploadCore(e){const t=e.value,a={name:t.name,loadedBytes:0,type:t.type,blobReader:new ye(t,this.chunkSize),guid:new Y,fileSize:t.size,count:this._getFileChunksCount(t),customData:{}};e.chunksData=a,this._sendChunk(e,a)}_getFileChunksCount(e){return e.size===0?1:Math.ceil(e.size/this.chunkSize)}_sendChunk(e,t){const a=t.blobReader.read();t.currentChunk=a,a&&this._sendChunkCore(e,t,a).done((()=>{var o;e.isAborted||(t.loadedBytes+=((o=a.blob)===null||o===void 0?void 0:o.size)??0,e.onProgress.fire({loaded:t.loadedBytes,total:e.value.size}),a.isCompleted&&e.onLoad.fire(),setTimeout((()=>this._sendChunk(e,t))))})).fail((o=>{this._shouldHandleError(e,o)&&this._handleFileError(e,o)}))}_sendChunkCore(e,t,a){return $().reject()}_tryRaiseStartLoad(e){e.isStartLoad||(e.isStartLoad=!0,e.onLoadStart.fire())}_getEvent(e){return null}_createUploadArgument(e){return this._createChunksInfo(e.chunksData)}_createChunksInfo(e){var t,a;return{bytesUploaded:e?.loadedBytes??0,chunkCount:e?.count??0,customData:e?.customData??{},chunkBlob:(e==null||(t=e.currentChunk)===null||t===void 0?void 0:t.blob)??new Blob,chunkIndex:(e==null||(a=e.currentChunk)===null||a===void 0?void 0:a.index)??0}}}class Ue extends te{_sendChunkCore(e,t,a){const{uploadUrl:o,uploadMethod:i,uploadHeaders:n,name:l}=this.fileUploader.option();return G.sendRequest({url:o,method:i,headers:n,beforeSend:r=>this._beforeSend(r,e),upload:{onprogress:r=>this._handleProgress(e,r),onloadstart:()=>this._tryRaiseStartLoad(e),onabort:()=>e.onAbort.fire()},data:this._createFormData({fileName:t.name,blobName:l,blob:a.blob,index:a.index,count:t.count,type:t.type,guid:t.guid,size:t.fileSize})})}_createFormData(e){const t=new U.FormData;return t.append(e.blobName,e.blob),t.append("chunkMetadata",JSON.stringify({FileName:e.fileName,Index:e.index,TotalCount:e.count,FileSize:e.size,FileType:e.type,FileGuid:e.guid})),this._extendFormData(t),t}}class $e extends te{_sendChunkCore(e,t){this._tryRaiseStartLoad(e);const a=this._createChunksInfo(t),{uploadChunk:o}=this.fileUploader.option();try{const i=o?.(e.value,a);return H(i)}catch(i){return $().reject(i).promise()}}_shouldHandleError(e,t){return!0}}class ae extends ee{_uploadCore(e){e.loadedSize=0;const t=this._uploadFile(e);"done"in t&&t.done((()=>{e.isAborted||e.onLoad.fire()})).fail((a=>{this._shouldHandleError(e,a)&&this._handleFileError(e,a)}))}_uploadFile(e){return $().reject()}_handleProgressCore(e,t){e.onProgress.fire(t)}_getLoadedData(e,t,a,o){const i=super._getLoadedData(e,t,a,o);return i.event=o,i}}class Ee extends ae{_uploadFile(e){const{uploadUrl:t,uploadMethod:a,uploadHeaders:o,name:i}=this.fileUploader.option();return G.sendRequest({url:t,method:a,headers:o,beforeSend:n=>this._beforeSend(n,e),upload:{onprogress:n=>this._handleProgress(e,n),onloadstart:()=>e.onLoadStart.fire(),onabort:()=>e.onAbort.fire()},data:this._createFormData(i,e.value)})}_createFormData(e,t){const a=new U.FormData;return a.append(e,t,t?.name),this._extendFormData(a),a}}class Me extends ae{_uploadFile(e){e.onLoadStart.fire();const t=o=>{const i={loaded:o,total:e.value.size};this._handleProgress(e,i)},{uploadFile:a}=this.fileUploader.option();try{const o=a?.(e.value,t);return H(o)}catch(o){return $().reject(o).promise()}}_shouldHandleError(e,t){return!0}}class oe extends X{_supportedKeys(){const e=t=>{t.preventDefault();const a=this._selectButton.$element();h.triggerHandler(a,{type:"dxclick"})};return T({},super._supportedKeys(),{space:e,enter:e})}_setOptionsByReference(){super._setOptionsByReference(),le(this._optionsByReference,{value:!0})}_getDefaultOptions(){return T({},super._getDefaultOptions(),{chunkSize:0,value:[],selectButtonText:c.format("dxFileUploader-selectFile"),uploadButtonText:c.format("dxFileUploader-upload"),labelText:c.format("dxFileUploader-dropFile"),name:"files[]",multiple:!1,accept:"",uploadUrl:"/",allowCanceling:!0,showFileList:!0,progress:0,dialogTrigger:void 0,dropZone:void 0,readyToUploadMessage:c.format("dxFileUploader-readyToUpload"),uploadedMessage:c.format("dxFileUploader-uploaded"),uploadFailedMessage:c.format("dxFileUploader-uploadFailedMessage"),uploadAbortedMessage:c.format("dxFileUploader-uploadAbortedMessage"),uploadMode:"instantly",uploadMethod:"POST",uploadHeaders:{},uploadCustomData:{},onBeforeSend:null,onUploadStarted:null,onUploaded:null,onFilesUploaded:null,onProgress:null,onUploadError:null,onUploadAborted:null,onDropZoneEnter:null,onDropZoneLeave:null,allowedFileExtensions:[],maxFileSize:0,minFileSize:0,inputAttr:{},invalidFileExtensionMessage:c.format("dxFileUploader-invalidFileExtension"),invalidMaxFileSizeMessage:c.format("dxFileUploader-invalidMaxFileSize"),invalidMinFileSizeMessage:c.format("dxFileUploader-invalidMinFileSize"),extendSelection:!0,validationMessageMode:"always",uploadFile:null,uploadChunk:null,abortUpload:null,validationMessageOffset:{h:0,v:0},hoverStateEnabled:!0,useNativeInputClick:!1,useDragOver:!0,nativeDropSupported:!0,_uploadButtonType:"normal",_buttonStylingMode:"contained"})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:()=>E.real().deviceType==="desktop"&&!E.isSimulator(),options:{focusStateEnabled:!0}},{device:[{platform:"android"}],options:{validationMessageOffset:{v:0}}},{device:()=>E.real().deviceType!=="desktop",options:{useDragOver:!1,nativeDropSupported:!1,labelText:""}},{device:()=>!O(),options:{uploadMode:"useForm"}},{device:()=>re(R()),options:{_uploadButtonType:"default"}},{device:()=>de(R()),options:{_buttonStylingMode:"text"}}])}_initOptions(e){const t="labelText"in e;super._initOptions(e),!t&&!this._shouldDragOverBeRendered()&&this.option({labelText:""})}_init(){super._init(),this._initFileInput(),this._initLabel(),this._setUploadStrategy(),this._createFiles(),this._createBeforeSendAction(),this._createUploadStartedAction(),this._createUploadedAction(),this._createFilesUploadedAction(),this._createProgressAction(),this._createUploadErrorAction(),this._createUploadAbortedAction(),this._createDropZoneEnterAction(),this._createDropZoneLeaveAction()}_setUploadStrategy(){const{chunkSize:e=0}=this.option();if(e>0){const{uploadChunk:t}=this.option();this._uploadStrategy=t&&k(t)?new $e(this):new Ue(this)}else{const{uploadFile:t}=this.option();this._uploadStrategy=t&&k(t)?new Me(this):new Ee(this)}}_initFileInput(){this._isCustomClickEvent=!1;const{multiple:e,accept:t,hint:a}=this.option();this._$fileInput||(this._$fileInput=Ce(),h.on(this._$fileInput,"change",this._inputChangeHandler.bind(this)),h.on(this._$fileInput,"click",(i=>{i.stopPropagation(),this._resetInputValue();const{useNativeInputClick:n}=this.option();return n||this._isCustomClickEvent})));const o={multiple:e,accept:t,tabIndex:-1};v(a)&&(o.title=a),this._$fileInput.prop(o)}_inputChangeHandler(){if(this._doPreventInputChange)return;const e=this._$fileInput.val().replace(/^.*\\/,""),t=this._$fileInput.prop("files"),{uploadMode:a}=this.option();if(t&&!t.length&&a!=="useForm")return;const o=t?this._getFiles(t):[{name:e}];this._changeValue(o),a==="instantly"&&this._uploadFiles()}_shouldFileListBeExtended(){const{uploadMode:e,extendSelection:t,multiple:a}=this.option();return!!(e!=="useForm"&&t&&a)}_changeValue(e){const{value:t}=this.option(),a=this._shouldFileListBeExtended()?t?.slice():[];this.option({value:a?.concat(e)})}_getFiles(e){return[...e]}_getFile(e){var t;const{value:a}=this.option(),o=ue(e)?a?.[e]:e;return(t=this._files)===null||t===void 0?void 0:t.filter((i=>i.value===o))[0]}_initLabel(){this._$inputLabel||(this._$inputLabel=s("<div>")),this._updateInputLabelText()}_updateInputLabelText(){const{labelText:e}=this.option(),t=this._isInteractionDisabled()?"":e;this._$inputLabel.text(t??"")}_focusTarget(){return this.$element().find(".dx-fileuploader-button")}_getSubmitElement(){return this._$fileInput}_initMarkup(){super._initMarkup(),this.$element().addClass("dx-fileuploader"),this._renderWrapper(),this._renderInputWrapper(),this._renderSelectButton(),this._renderInputContainer(),this._renderUploadButton(),this._preventRecreatingFiles=!0,this._activeDropZone=null}_render(){const{dropZone:e}=this.option();this._preventRecreatingFiles=!1,this._attachDragEventHandlers(this._$inputWrapper),this._attachDragEventHandlers(e),this._renderFiles(),super._render()}_createFileProgressBar(e){e.progressBar=this._createProgressBar(e.value.size),e.$file&&e.progressBar.$element().appendTo(e.$file),this._initStatusMessage(e),this._ensureCancelButtonInitialized(e)}_setStatusMessage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";setTimeout((()=>{const{showFileList:a}=this.option();if(a&&e.$statusMessage){var o;e.$statusMessage.text(t),e.$statusMessage.css("display",""),(o=e.progressBar)===null||o===void 0||o.$element().remove()}}),400)}_getUploadAbortedStatusMessage(){const{uploadMode:e,uploadAbortedMessage:t,readyToUploadMessage:a}=this.option();return e==="instantly"?t:a}_createFiles(){const{value:e}=this.option();this._files&&(e?.length===0||!this._shouldFileListBeExtended())&&(this._preventFilesUploading(this._files),this._files=null),this._files||(this._files=[]),e?.slice(this._files.length).forEach((t=>{var a;const o=this._createFile(t);this._validateFile(o),(a=this._files)===null||a===void 0||a.push(o)}))}_preventFilesUploading(e){e?.forEach((t=>this._uploadStrategy.abortUpload(t)))}_validateFile(e){e.isValidFileExtension=this._validateFileExtension(e),e.isValidMinSize=this._validateMinFileSize(e),e.isValidMaxSize=this._validateMaxFileSize(e)}_validateFileExtension(e){const{allowedFileExtensions:t}=this.option();return t!=null&&t.length?this._isFileExtensionAllowed(e.value,t):!0}_validateMaxFileSize(e){const t=e.value.size,{maxFileSize:a=0}=this.option();return a>0?t<=a:!0}_validateMinFileSize(e){const t=e.value.size,{minFileSize:a=0}=this.option();return a>0?t>=a:!0}_isFileExtensionAllowed(e,t){for(let a=0,o=t.length;a<o;a+=1){let i=t[a];if(i.startsWith(".")){if(i=i.replace(".","\\."),new RegExp(`${i}$`,"i").exec(e.name))return!0}else if(i=i.replace(new RegExp("\\*","g"),""),new RegExp(i,"i").exec(e.type))return!0}return!1}_createBeforeSendAction(){this._beforeSendAction=this._createActionByOption("onBeforeSend",{excludeValidators:["readOnly"]})}_createUploadStartedAction(){this._uploadStartedAction=this._createActionByOption("onUploadStarted",{excludeValidators:["readOnly"]})}_createUploadedAction(){this._uploadedAction=this._createActionByOption("onUploaded",{excludeValidators:["readOnly"]})}_createFilesUploadedAction(){this._filesUploadedAction=this._createActionByOption("onFilesUploaded",{excludeValidators:["readOnly"]})}_createProgressAction(){this._progressAction=this._createActionByOption("onProgress",{excludeValidators:["readOnly"]})}_createUploadAbortedAction(){this._uploadAbortedAction=this._createActionByOption("onUploadAborted",{excludeValidators:["readOnly"]})}_createUploadErrorAction(){this._uploadErrorAction=this._createActionByOption("onUploadError",{excludeValidators:["readOnly"]})}_createDropZoneEnterAction(){this._dropZoneEnterAction=this._createActionByOption("onDropZoneEnter")}_createDropZoneLeaveAction(){this._dropZoneLeaveAction=this._createActionByOption("onDropZoneLeave")}_createFile(e){return{value:e,loadedSize:0,onProgress:y(),onAbort:y(),onLoad:y(),onError:y(),onLoadStart:y(),isValidFileExtension:!0,isValidMaxSize:!0,isValidMinSize:!0,isValid(){return!!this.isValidFileExtension&&!!this.isValidMaxSize&&!!this.isValidMinSize},isInitialized:!1}}_resetFileState(e){e.isAborted=!1,e.uploadStarted=!1,e.isStartLoad=!1,e.loadedSize=0,e.chunksData=void 0,e.request=void 0}_renderFiles(){var e;const{value:t,showFileList:a}=this.option();if(this._$filesContainer?(!this._shouldFileListBeExtended()||t?.length===0)&&this._$filesContainer.empty():this._$filesContainer=s("<div>").addClass("dx-fileuploader-files-container").appendTo(this._$content),a){var o;(o=this._files)===null||o===void 0||o.forEach((i=>{i.$file||this._renderFile(i)}))}this.$element().toggleClass("dx-fileuploader-show-file-list",a),this._toggleFileUploaderEmptyClassName(),this._updateFileNameMaxWidth(),(e=this._validationMessage)===null||e===void 0||e.repaint()}_renderFile(e){const{value:t}=e;if(!this._$filesContainer)return;const a=s("<div>").addClass("dx-fileuploader-file-container").appendTo(this._$filesContainer);this._renderFileButtons(e,a),e.$file=s("<div>").addClass("dx-fileuploader-file").appendTo(a);const o=s("<div>").addClass("dx-fileuploader-file-info").appendTo(e.$file);if(e.$statusMessage=s("<div>").addClass("dx-fileuploader-file-status-message").appendTo(e.$file),s("<div>").addClass("dx-fileuploader-file-name").text(t.name).appendTo(o),v(t.size)&&s("<div>").addClass("dx-fileuploader-file-size").text(this._getFileSize(t.size)).appendTo(o),e.isValid()){const{readyToUploadMessage:i}=this.option();e.$statusMessage.text(i??"")}else e.isValidFileExtension||e.$statusMessage.append(this._createValidationElement("invalidFileExtensionMessage")),e.isValidMaxSize||e.$statusMessage.append(this._createValidationElement("invalidMaxFileSizeMessage")),e.isValidMinSize||e.$statusMessage.append(this._createValidationElement("invalidMinFileSizeMessage")),a.addClass("dx-fileuploader-invalid")}_createValidationElement(e){return s("<span>").text(this.option()[e])}_updateFileNameMaxWidth(){var e,t,a,o;const{allowCanceling:i,uploadMode:n}=this.option(),l=i&&n!=="useForm"?1:0,r=n==="useButtons"?1:0,b=M((e=this._$filesContainer)===null||e===void 0?void 0:e.find(".dx-fileuploader-file-container").first())||M(this._$filesContainer),S=(t=this._$filesContainer)===null||t===void 0?void 0:t.find(".dx-fileuploader-button-container").eq(0),f=M(S)*(l+r),p=(a=this._$filesContainer)===null||a===void 0?void 0:a.find(".dx-fileuploader-file-size").eq(0),D=p?.text();p?.text("1000 Mb");const _=M(p);p?.text(D??""),(o=this._$filesContainer)===null||o===void 0||o.find(".dx-fileuploader-file-name").css("maxWidth",b-f-_)}_renderFileButtons(e,t){const a=this._getCancelButton(e);a&&t.append(a);const o=this._getUploadButton(e);o&&t.append(o)}_getCancelButton(e){const{uploadMode:t}=this.option();if(t==="useForm")return null;const{allowCanceling:a,readOnly:o,hoverStateEnabled:i,_buttonStylingMode:n}=this.option();return e.cancelButton=this._createComponent(s("<div>").addClass("dx-fileuploader-button dx-fileuploader-cancel-button"),B,{onClick:()=>{this._removeFile(e)},icon:"close",visible:a,disabled:o,integrationOptions:{},hoverStateEnabled:i,stylingMode:n}),s("<div>").addClass("dx-fileuploader-button-container").append(e.cancelButton.$element())}_getUploadButton(e){const{uploadMode:t}=this.option();if(!e.isValid()||t!=="useButtons")return null;const{hoverStateEnabled:a,_buttonStylingMode:o}=this.option();return e.uploadButton=this._createComponent(s("<div>").addClass("dx-fileuploader-button dx-fileuploader-upload-button"),B,{onClick:()=>this._uploadFile(e),icon:"upload",hoverStateEnabled:a,stylingMode:o}),e.onLoadStart.add((()=>{var i;return(i=e.uploadButton)===null||i===void 0?void 0:i.option({visible:!1,disabled:!0})})),e.onAbort.add((()=>{var i;return(i=e.uploadButton)===null||i===void 0?void 0:i.option({visible:!0,disabled:!1})})),s("<div>").addClass("dx-fileuploader-button-container").append(e.uploadButton.$element())}_removeFile(e){var t,a;(t=e.$file)===null||t===void 0||t.parent().remove(),(a=this._files)===null||a===void 0||a.splice(this._files.indexOf(e),1);const{value:o}=this.option(),i=o?.slice();i?.splice(i.indexOf(e.value),1),this._preventRecreatingFiles=!0,this.option({value:i}),this._preventRecreatingFiles=!1,this._toggleFileUploaderEmptyClassName(),this._resetInputValue(!0)}removeFile(e){const{uploadMode:t}=this.option();if(t==="useForm"||!v(e))return;const a=this._getFile(e);a&&(a.uploadStarted&&this._preventFilesUploading([a]),this._removeFile(a))}_toggleFileUploaderEmptyClassName(){var e;this.$element().toggleClass("dx-fileuploader-empty",!((e=this._files)!==null&&e!==void 0&&e.length)||this._hasInvalidFile(this._files))}_hasInvalidFile(e){return e.some((t=>!t.isValid()))}_getFileSize(e){const t=[c.format("dxFileUploader-bytes"),c.format("dxFileUploader-kb"),c.format("dxFileUploader-Mb"),c.format("dxFileUploader-Gb")],a=t.length-1;let o=e,i=0;for(;i<a&&o>=1024;)o/=1024,i+=1;return`${Math.round(o)} ${t[i]}`}_renderSelectButton(){const e=s("<div>").addClass("dx-fileuploader-button").appendTo(this._$inputWrapper),{selectButtonText:t,readOnly:a,hoverStateEnabled:o}=this.option();this._selectButton=this._createComponent(e,B,{text:t,focusStateEnabled:!1,integrationOptions:{},disabled:a,hoverStateEnabled:o}),E.real().deviceType==="desktop"?this._selectButton.option({onClick:()=>this._selectFileDialogClickHandler()}):this._attachSelectFileDialogHandlers(this._selectButton.$element());const{dialogTrigger:i}=this.option();this._attachSelectFileDialogHandlers(i)}_selectFileDialogClickHandler(){const{useNativeInputClick:e}=this.option();e||this._isInteractionDisabled()||(this._isCustomClickEvent=!0,h.trigger(this._$fileInput,"click"),this._isCustomClickEvent=!1)}_attachSelectFileDialogHandlers(e){if(!v(e))return;this._detachSelectFileDialogHandlers(e);const t=s(e);h.on(t,F("click","dxFileUploaderDialogTrigger"),(()=>{this._selectFileDialogClickHandler()})),h.on(t,F("keyup","dxFileUploaderDialogTrigger"),(a=>{const o=pe(a);(o==="enter"||o==="space")&&this._selectFileDialogClickHandler()}))}_detachSelectFileDialogHandlers(e){if(!v(e))return;const t=s(e);h.off(t,".dxFileUploaderDialogTrigger")}_renderUploadButton(){const{uploadButtonText:e,_uploadButtonType:t,hoverStateEnabled:a,uploadMode:o}=this.option();if(o!=="useButtons")return;const i=s("<div>").addClass("dx-fileuploader-button").addClass("dx-fileuploader-upload-button").appendTo(this._$content);this._uploadButton=this._createComponent(i,B,{text:e,onClick:this._uploadButtonClickHandler.bind(this),type:t,integrationOptions:{},hoverStateEnabled:a})}_uploadButtonClickHandler(){this._uploadFiles()}_shouldDragOverBeRendered(){const{readOnly:e,uploadMode:t,nativeDropSupported:a}=this.option();return!e&&(t!=="useForm"||a)}_isInteractionDisabled(){const{readOnly:e,disabled:t}=this.option();return!!e||!!t}_renderInputContainer(){this._$inputContainer=s("<div>").addClass("dx-fileuploader-input-container").appendTo(this._$inputWrapper),this._$fileInput.addClass("dx-fileuploader-input"),this._renderInput();const e=`dx-fileuploader-input-label-${new Y}`;this._$inputLabel.attr("id",e).addClass("dx-fileuploader-input-label").appendTo(this._$inputContainer),this.setAria("labelledby",e,this._$fileInput)}_renderInput(){const{useNativeInputClick:e,inputAttr:t}=this.option();e?this._selectButton.option({template:this._selectButtonInputTemplate.bind(this)}):(this._$fileInput.appendTo(this._$inputContainer),this._selectButton.option({template:"content"})),this._applyInputAttributes(t)}_selectButtonInputTemplate(e,t){const a=s(t),o=s("<span>").addClass("dx-button-text").text(e.text);return a.append(o).append(this._$fileInput),a}_renderInputWrapper(){this._$content&&(this._$inputWrapper=s("<div>").addClass("dx-fileuploader-input-wrapper").appendTo(this._$content))}_detachDragEventHandlers(e){e&&h.off(s(e),F("",this.NAME))}_attachDragEventHandlers(e){const t=e!==this._$inputWrapper;!v(e)||!this._shouldDragOverBeRendered()||(this._detachDragEventHandlers(e),h.on(s(e),F("dragenter",this.NAME),this._dragEnterHandler.bind(this,t)),h.on(s(e),F("dragover",this.NAME),this._dragOverHandler.bind(this,t)),h.on(s(e),F("dragleave",this.NAME),this._dragLeaveHandler.bind(this,t)),h.on(s(e),F("drop",this.NAME),this._dropHandler.bind(this,t)))}_applyInputAttributes(e){this._$fileInput.attr(e)}_useInputForDrop(){const{uploadMode:e,nativeDropSupported:t}=this.option();return!!t&&e==="useForm"}_getDropZoneElement(e,t){if(!t.currentTarget)return;const{dropZone:a}=this.option(),i=(e?s(a).toArray():[this._$inputWrapper]).map((l=>s(l).get(0))),n=i.indexOf(t.currentTarget);return i[n]}_dragEnterHandler(e,t){const{disabled:a}=this.option();if(a)return!1;this._useInputForDrop()||t.preventDefault();const o=this._getDropZoneElement(e,t);v(o)&&this._shouldRaiseDragOver(t,o)&&(this._activeDropZone=o,this._tryToggleDropZoneActive(!0,e,t))}_shouldRaiseDragOver(e,t){return this._activeDropZone===null&&this.isMouseOverElement(e,t,!1)&&e.originalEvent.dataTransfer.types.find((a=>a==="Files"))}_dragOverHandler(e,t){if(this._useInputForDrop()||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",!e){const a=this._getDropZoneElement(!1,t);this._shouldRaiseDragOver(t,a)&&this._dragEnterHandler(!1,t),this._shouldRaiseDragLeave(t,!1)&&this._dragLeaveHandler(!1,t)}}_dragLeaveHandler(e,t){this._useInputForDrop()||t.preventDefault(),this._shouldRaiseDragLeave(t,e)&&(this._tryToggleDropZoneActive(!1,e,t),this._activeDropZone=null)}_shouldRaiseDragLeave(e,t){return this._activeDropZone!==null&&!this.isMouseOverElement(e,this._activeDropZone,!t,-1)}_tryToggleDropZoneActive(e,t,a){var o;const i=e?"addClass":"removeClass";(o=this[e?"_dropZoneEnterAction":"_dropZoneLeaveAction"])===null||o===void 0||o.call(this,{event:a,dropZoneElement:this._activeDropZone}),t||this.$element()[i]("dx-fileuploader-dragover")}_dropHandler(e,t){if(this._activeDropZone=null,e||this.$element().removeClass("dx-fileuploader-dragover"),this._useInputForDrop()||e&&this._isInteractionDisabled())return;t.preventDefault();const a=t.originalEvent.dataTransfer.files,o=this._getFiles(a),{multiple:i}=this.option();if(!i&&o.length>1||o.length===0)return;this._changeValue(o);const{uploadMode:n}=this.option();n==="instantly"&&this._uploadFiles()}_areAllFilesLoaded(){var e;return(e=this._files)===null||e===void 0?void 0:e.every((t=>!t.isValid()||t._isError||t._isLoaded||t.isAborted))}_handleAllFilesUploaded(){if(this._recalculateProgress(),this._areAllFilesLoaded()){var e;(e=this._filesUploadedAction)===null||e===void 0||e.call(this)}}_renderWrapper(){const e=s("<div>").addClass("dx-fileuploader-wrapper").appendTo(this.$element()),t=s("<div>").addClass("dx-fileuploader-container").appendTo(e);this._$content=s("<div>").addClass("dx-fileuploader-content").appendTo(t)}_clean(){this._$fileInput.detach(),this._$filesContainer=null;const{dialogTrigger:e,dropZone:t}=this.option();this._detachSelectFileDialogHandlers(e),this._detachDragEventHandlers(t),this._files&&this._files.forEach((a=>{a.$file=null,a.$statusMessage=null})),super._clean()}abortUpload(e){const{uploadMode:t}=this.option();if(t!=="useForm")if(v(e)){const a=this._getFile(e);a&&this._preventFilesUploading([a])}else this._preventFilesUploading(this._files)}upload(e){const{uploadMode:t}=this.option();if(t!=="useForm")if(v(e)){const a=this._getFile(e);a&&O()&&this._uploadFile(a)}else this._uploadFiles()}_uploadFiles(){if(O()){var e;(e=this._files)===null||e===void 0||e.forEach((t=>this._uploadFile(t)))}}_uploadFile(e){this._uploadStrategy.upload(e)}_updateProgressBar(e,t){var a,o;(a=e.progressBar)===null||a===void 0||a.option({value:t.loaded,showStatus:!0}),(o=this._progressAction)===null||o===void 0||o.call(this,{file:e.value,segmentSize:t.currentSegmentSize,bytesLoaded:t.loaded,bytesTotal:t.total,event:t.event,request:e.request})}_updateTotalProgress(e,t){let a=0;v(e)&&(this._files&&this._files.length>0&&this._areAllFilesLoaded()&&e===0&&t===0?a=this._getProgressValue(1):e&&(a=this._getProgressValue(t/e))),this.option({progress:a}),this._setLoadedSize(t)}_getProgressValue(e){return Math.floor(100*e)}_initStatusMessage(e){var t;(t=e.$statusMessage)===null||t===void 0||t.css("display","none")}_ensureCancelButtonInitialized(e){var t;if(e.isInitialized)return;(t=e.cancelButton)===null||t===void 0||t.option({onClick:()=>{this._preventFilesUploading([e]),this._removeFile(e)}});const a=()=>{setTimeout((()=>{var o;(o=e.cancelButton)===null||o===void 0||o.option({visible:!1})}),400)};e.onLoad.add(a),e.onError.add(a)}_createProgressBar(e){return this._createComponent(s("<div>"),Q,{value:void 0,min:0,max:e,statusFormat:t=>`${this._getProgressValue(t)}%`,showStatus:!1,statusPosition:"right"})}_getTotalFilesSize(){if(!this._totalFilesSize){var e;this._totalFilesSize=0,(e=this._files)===null||e===void 0||e.forEach((t=>{this._totalFilesSize+=t.value.size}))}return this._totalFilesSize}_getTotalLoadedFilesSize(){if(!this._totalLoadedFilesSize){var e;this._totalLoadedFilesSize=0,(e=this._files)===null||e===void 0||e.forEach((t=>{this._totalLoadedFilesSize+=t.loadedSize}))}return this._totalLoadedFilesSize}_setLoadedSize(e){this._totalLoadedFilesSize=e}_recalculateProgress(){this._totalFilesSize=0,this._totalLoadedFilesSize=0,this._updateTotalProgress(this._getTotalFilesSize(),this._getTotalLoadedFilesSize())}isMouseOverElement(e,t,a){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(!t)return!1;const i=a?parseFloat(U.getComputedStyle(t,":before").height):0,n=a?parseFloat(U.getComputedStyle(t,":after").height):0,l=V(t).left,r=V(t).top+i,b=t.offsetWidth,S=t.offsetHeight-i-n,f=this._getEventX(e),p=this._getEventY(e);return f+o>=l&&f-o<l+b&&p+o>=r&&p-o<r+S}_getEventX(e){return N(e)?this._getTouchEventX(e):e.clientX+this._getDocumentScrollLeft()}_getEventY(e){return N(e)?this._getTouchEventY(e):e.clientY+this._getDocumentScrollTop()}_getTouchEventX(e){let t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageX:0}_getTouchEventY(e){let t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageY:0}_getDocumentScrollTop(){const e=Z.getDocument();return e.documentElement.scrollTop||e.body.scrollTop}_getDocumentScrollLeft(){const e=Z.getDocument();return e.documentElement.scrollLeft||e.body.scrollLeft}_updateReadOnlyState(){var e;const{readOnly:t}=this.option();this._selectButton.option({disabled:t}),(e=this._files)===null||e===void 0||e.forEach((a=>{var o;return(o=a.cancelButton)===null||o===void 0?void 0:o.option({disabled:t})})),this._updateInputLabelText(),this._attachDragEventHandlers(this._$inputWrapper)}_updateHoverState(){var e,t,a;const{hoverStateEnabled:o}=this.option();(e=this._selectButton)===null||e===void 0||e.option({hoverStateEnabled:o}),(t=this._uploadButton)===null||t===void 0||t.option({hoverStateEnabled:o}),(a=this._files)===null||a===void 0||a.forEach((i=>{var n,l;(n=i.uploadButton)===null||n===void 0||n.option({hoverStateEnabled:o}),(l=i.cancelButton)===null||l===void 0||l.option({hoverStateEnabled:o})}))}_optionChanged(e){var t;const{name:a,value:o,previousValue:i}=e;switch(a){case"height":case"width":this._updateFileNameMaxWidth(),super._optionChanged(e);break;case"value":o!=null&&o.length||this._$fileInput.val(""),this._preventRecreatingFiles||(this._createFiles(),this._renderFiles()),this._recalculateProgress(),super._optionChanged(e);break;case"name":case"hint":this._initFileInput(),super._optionChanged(e);break;case"accept":this._initFileInput();break;case"multiple":this._initFileInput(),e.value||this.clear();break;case"readOnly":this._updateReadOnlyState(),super._optionChanged(e);break;case"disabled":this._updateInputLabelText(),super._optionChanged(e);break;case"selectButtonText":this._selectButton.option({text:o});break;case"uploadButtonText":this._uploadButton&&this._uploadButton.option({text:o});break;case"_uploadButtonType":this._uploadButton&&this._uploadButton.option({type:o});break;case"_buttonStylingMode":(t=this._files)===null||t===void 0||t.forEach((n=>{var l,r;(l=n.uploadButton)===null||l===void 0||l.option({stylingMode:o}),(r=n.cancelButton)===null||r===void 0||r.option({stylingMode:o})}));break;case"dialogTrigger":this._detachSelectFileDialogHandlers(i),this._attachSelectFileDialogHandlers(o);break;case"dropZone":this._detachDragEventHandlers(i),this._attachDragEventHandlers(o);break;case"maxFileSize":case"minFileSize":case"allowedFileExtensions":case"invalidFileExtensionMessage":case"invalidMaxFileSizeMessage":case"invalidMinFileSizeMessage":case"readyToUploadMessage":case"uploadedMessage":case"uploadFailedMessage":case"uploadAbortedMessage":case"nativeDropSupported":this._invalidate();break;case"labelText":this._updateInputLabelText();break;case"showFileList":this._preventRecreatingFiles||this._renderFiles();break;case"uploadFile":case"uploadChunk":case"chunkSize":this._setUploadStrategy();break;case"abortUpload":case"uploadUrl":case"progress":case"uploadMethod":case"uploadHeaders":case"uploadCustomData":case"extendSelection":break;case"hoverStateEnabled":this._updateHoverState(),super._optionChanged(e);break;case"allowCanceling":case"uploadMode":this.clear(),this._invalidate();break;case"onBeforeSend":this._createBeforeSendAction();break;case"onUploadStarted":this._createUploadStartedAction();break;case"onUploaded":this._createUploadedAction();break;case"onFilesUploaded":this._createFilesUploadedAction();break;case"onProgress":this._createProgressAction();break;case"onUploadError":this._createUploadErrorAction();break;case"onUploadAborted":this._createUploadAbortedAction();break;case"onDropZoneEnter":this._createDropZoneEnterAction();break;case"onDropZoneLeave":this._createDropZoneLeaveAction();break;case"useNativeInputClick":this._renderInput();break;case"useDragOver":this._attachDragEventHandlers(this._$inputWrapper);break;case"inputAttr":this._applyInputAttributes(this.option()[a]);break;default:super._optionChanged(e)}}_resetInputValue(e){const{uploadMode:t}=this.option();t==="useForm"&&!e||(this._doPreventInputChange=!0,this._$fileInput.val(""),this._doPreventInputChange=!1)}clear(){this.option({value:[]})}}P("dxFileUploader",oe);const ie={props:{abortUpload:Function,accept:String,accessKey:String,activeStateEnabled:Boolean,allowCanceling:Boolean,allowedFileExtensions:Array,chunkSize:Number,dialogTrigger:{},disabled:Boolean,dropZone:{},elementAttr:Object,focusStateEnabled:Boolean,height:[Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},invalidFileExtensionMessage:String,invalidMaxFileSizeMessage:String,invalidMinFileSizeMessage:String,isDirty:Boolean,isValid:Boolean,labelText:String,maxFileSize:Number,minFileSize:Number,multiple:Boolean,name:String,onBeforeSend:Function,onContentReady:Function,onDisposing:Function,onDropZoneEnter:Function,onDropZoneLeave:Function,onFilesUploaded:Function,onInitialized:Function,onOptionChanged:Function,onProgress:Function,onUploadAborted:Function,onUploaded:Function,onUploadError:Function,onUploadStarted:Function,onValueChanged:Function,progress:Number,readOnly:Boolean,readyToUploadMessage:String,rtlEnabled:Boolean,selectButtonText:String,showFileList:Boolean,tabIndex:Number,uploadAbortedMessage:String,uploadButtonText:String,uploadChunk:Function,uploadCustomData:{},uploadedMessage:String,uploadFailedMessage:String,uploadFile:Function,uploadHeaders:{},uploadMethod:String,uploadMode:String,uploadUrl:String,validationError:{},validationErrors:Array,validationStatus:String,value:Array,visible:Boolean,width:[Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:abortUpload":null,"update:accept":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:allowCanceling":null,"update:allowedFileExtensions":null,"update:chunkSize":null,"update:dialogTrigger":null,"update:disabled":null,"update:dropZone":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:invalidFileExtensionMessage":null,"update:invalidMaxFileSizeMessage":null,"update:invalidMinFileSizeMessage":null,"update:isDirty":null,"update:isValid":null,"update:labelText":null,"update:maxFileSize":null,"update:minFileSize":null,"update:multiple":null,"update:name":null,"update:onBeforeSend":null,"update:onContentReady":null,"update:onDisposing":null,"update:onDropZoneEnter":null,"update:onDropZoneLeave":null,"update:onFilesUploaded":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onProgress":null,"update:onUploadAborted":null,"update:onUploaded":null,"update:onUploadError":null,"update:onUploadStarted":null,"update:onValueChanged":null,"update:progress":null,"update:readOnly":null,"update:readyToUploadMessage":null,"update:rtlEnabled":null,"update:selectButtonText":null,"update:showFileList":null,"update:tabIndex":null,"update:uploadAbortedMessage":null,"update:uploadButtonText":null,"update:uploadChunk":null,"update:uploadCustomData":null,"update:uploadedMessage":null,"update:uploadFailedMessage":null,"update:uploadFile":null,"update:uploadHeaders":null,"update:uploadMethod":null,"update:uploadMode":null,"update:uploadUrl":null,"update:validationError":null,"update:validationErrors":null,"update:validationStatus":null,"update:value":null,"update:visible":null,"update:width":null},computed:{instance(){return this.$_instance}},beforeCreate(){this.$_WidgetClass=oe,this.$_hasAsyncTemplate=!0}};_e(ie);const Be=he(ie),Ae=d=>new Promise((e,t)=>{const a=new Image;a.onload=()=>e(a),a.onerror=t,a.src=URL.createObjectURL(d)}),q=(d,e=1600)=>{const{width:t,height:a}=d,o=Math.min(1,e/Math.max(t,a)),i=Math.round(t*o),n=Math.round(a*o),l=document.createElement("canvas");return l.width=i,l.height=n,l.getContext("2d").drawImage(d,0,0,i,n),l},j=(d,e=.8,t="image/jpeg")=>new Promise(a=>{d.toBlob(o=>a(o),t,e)}),K=d=>new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(d)}),ze=async({file:d,maxPx:e=1600,quality:t=.8,thumbPx:a=256,thumbQuality:o=.7})=>{const i=await Ae(d),n=q(i,e),l=await j(n,t,"image/jpeg"),r=await K(l),b=q(i,a),S=await j(b,o,"image/jpeg"),f=await K(S);return{id:crypto.randomUUID(),name:d.name.replace(/\.(heic|heif)$/i,".jpg"),type:"image/jpeg",sizeOriginal:d.size,sizeCompressed:l.size,dataUrl:r,thumbUrl:f,ts:Date.now()}},Te={class:"upload-wrapper"},ke={class:"field-label"},De={key:0,class:"dropzone-text"},Ie={key:1,class:"file-list"},we={key:0,class:"thumb"},Le=["src"],Oe={class:"file-info"},Pe={class:"file-name"},He={class:"file-meta"},Re=["onClick"],Ve={key:2,class:"dropzone-loading-overlay"},Ne={__name:"DynamicImageUpload",props:{modelValue:{type:Array,default:()=>[]},label:{type:String,default:"ì´ë¯¸ì§€ ì²¨ë¶€"},multiple:{type:Boolean,default:!0},maxCount:{type:Number,default:10},maxSizeMB:{type:Number,default:10},maxPx:{type:Number,default:1600},quality:{type:Number,default:.8},thumbPx:{type:Number,default:256},thumbQuality:{type:Number,default:.7}},emits:["update:modelValue"],setup(d,{emit:e}){const t=d,a=e,o=`dynamic-dropzone-${crypto.randomUUID()}`,i=`dynamic-uploader-${crypto.randomUUID()}`,n=L(!1),l=L(!1),r=L([]);ve(()=>t.modelValue,_=>r.value=Array.isArray(_)?_:[],{immediate:!0});const b=()=>n.value=!0,S=()=>n.value=!1,f=_=>{const g=_.map(u=>({id:u.id,name:u.name,type:u.type,sizeOriginal:u.sizeOriginal,sizeCompressed:u.sizeCompressed,dataUrl:u.dataUrl,thumbUrl:u.thumbUrl,ts:u.ts}));a("update:modelValue",JSON.parse(JSON.stringify(g)))},p=async _=>{const g=_.value||[];if(!g.length)return;l.value=!0;const u=[];for(const I of g){if(r.value.length+u.length>=t.maxCount)break;if(I.size>t.maxSizeMB*1024*1024)continue;const ne=await ze({file:I,maxPx:t.maxPx,quality:t.quality,thumbPx:t.thumbPx,thumbQuality:t.thumbQuality});u.push(ne)}r.value=[...r.value,...u],f(r.value),l.value=!1},D=_=>{r.value=r.value.filter(g=>g.id!==_),f(r.value)};return(_,g)=>(C(),x("div",Te,[m("div",ke,A(d.label),1),m("div",{id:o,class:Se(["dropzone",{"dropzone-active":n.value}])},[r.value.length?z("",!0):(C(),x("div",De,[...g[0]||(g[0]=[m("span",null,"ðŸ“ ì´ë¯¸ì§€ë¥¼ ë“œëž˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì„ íƒí•˜ì„¸ìš”",-1)])])),r.value.length?(C(),x("ul",Ie,[(C(!0),x(fe,null,be(r.value,u=>(C(),x("li",{key:u.id},[u.thumbUrl||u.previewUrl?(C(),x("div",we,[m("img",{src:u.thumbUrl||u.previewUrl,alt:"preview"},null,8,Le)])):z("",!0),m("div",Oe,[m("div",Pe,A(u.name),1),m("div",He," ì›ë³¸ "+A((u.sizeOriginal/1024).toFixed(1))+" KB â†’ ì••ì¶• "+A((u.sizeCompressed/1024).toFixed(1))+" KB ",1)]),m("button",{class:"remove-btn",onClick:xe(I=>D(u.id),["stop"])},"âœ•",8,Re)]))),128))])):z("",!0),l.value?(C(),x("div",Ve,[...g[1]||(g[1]=[m("div",{class:"loading-bar"},null,-1),m("span",{class:"loading-text"},"ì••ì¶•/ì²˜ë¦¬ ì¤‘...",-1)])])):z("",!0)],2),me(Fe(Be),{id:i,"dialog-trigger":`#${o}`,"drop-zone":`#${o}`,accept:"image/*",multiple:d.multiple,"upload-mode":"useForm",visible:"false",onDropZoneEnter:b,onDropZoneLeave:S,onValueChanged:p},null,8,["dialog-trigger","drop-zone","multiple"])]))}},We=ge(Ne,[["__scopeId","data-v-c215ba98"]]);export{We as default};
